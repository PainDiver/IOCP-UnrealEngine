# IOCP-UnrealEngine

IOCP 서버, Unreal Engine 클라이언트 연동

이 리파지토리에는 클라이언트 파일, 서버 파일 모두 존재합니다.

IOCP서버는 C++Server에서 ServerCore를 컴파일 해서 라이브러리 파일을 생성 후, C++Server를 실행시켜서 사용하면 됩니다.

클라이언트는 uproject.bat을 실행시키면 소스파일에 존재하는 protobuf.dll이 binary에 생성되어 protobuf를 사용할 수 있게 됩니다.

그리고 uproject의 generate visual studio file 후, 실행시켜 언리얼엔진5 에디터로 들어갈 수 있습니다.


# 내용

서버가 켜진 상태에서 클라이언트가 켜지면, 로컬에 있는 서버를 찾아서 접속 후,
FSocket을 이용해서 논블로킹으로 받도록 구현해놨습니다.

클라이언트와 서버는 고유한 PacketHeader를 지니고 있어서, 이를 Serialize 한 후, 패킷을 해석하면서 서로 통신하게 됩니다.

여기서는 서버 접속,입장, 움직임 패킷정도만 사용합니다.

1. 클라이언트는 서버 접속 시 바로 로그인 패킷을 보내고, 서버는 이를 받아서 ID를 발급합니다.
2. 클라이언트는 서버에게 ID를 받고, 캐릭터를 게임모드클래스를 통해서 스폰 한 후, 입장 패킷을 서버에게 보내게 됩니다.
3. 서버는 입장 패킷을 받고, 현재 방에 들어있는 모든 캐릭터들의 명단을 보내주고, 클라이언트는 이를 받아 로컬에서 다른 캐릭터들을 생성하게 됩니다.
4. 캐릭터는 NetCharacter라 하여 소켓 통신의 내용을 전달받을 수 있는 특수한 클래스이며, Unreal Engine의 기본 캐릭터가 이를 상속합니다.
5. 로컬에서 컨트롤하는 캐릭터는 타이머매니저를 통해서 1초당 4번정도 무브패킷을 보내고, 컨트롤하지 않는 캐릭터는 무브패킷을 서버로부터 받은 무브패킷을 참조합니다.

위 단계를 걸쳐서 Standalone 모드에서 서버를 통해서 통신이 가능합니다
움직임은 무브패킷의 이동여부에 따라서 애니메이션이 동작되도록 설정해 놓았으며, 움직임이 끊어져 보이지 않도록, 패킷 간 보간처리를 통해서 자연스럽게 움직이도록 만들어 놓았습니다.


# 외부 라이브러리

외부 라이브러리로 Google의 ProtoBuf 21.x버전이 사용되었습니다.
